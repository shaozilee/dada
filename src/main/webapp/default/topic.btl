<!DOCTYPE html>
<html>
  <head>
    <title>${topic.subject}-www.dadania.com</title>
    <% include("_common.btl"){} %>
    <link rel="stylesheet" href="${ctxPath}/${theme}/js/ue/themes/default/css/umeditor.css">
    <link rel="stylesheet" href="${ctxPath}/${theme}/css/topic.css">
  </head>
  <body>
    <% include("_header.btl"){} %>
    <div class="page">
      <div class="page-wrap">
        <div class="topic-title clearfix">
          <h1>${topic.subject}</h1>
        </div>
        <div class="topic">
          <div class="topic-top">${topic.userName}发表于${topic.dateLine}</div>
          <div class="topic-body">${topic.message}</div>
        </div>

        <ul class="post-list" id="postList">
          <% for(post in postList){%>
          <li class="post clearfix" id="post-${post.pid}" data-pid="${post.pid}" data-username="${post.userName}" data-uid="${post.uid}">
            <div class="post-info">
              <div class="photo"><img src="${ctxPath}/${theme}/images/default-master.jpg" alt=""/></div>
              <div class="mem">${post.userName}</div>

              <div class="other"><a class="post-ta icon-ppost" data-pid="${post.pid}"></a></div>
              <div class="date">${post.dateLine}</div>
            </div>
            <div class="post-message">
              ${post.message}
            </div>
            <%
            var ppList = ppMap[post.pid+""];
            %>
            <div class="post-post ${ (null!=ppList)?'show':'hidden' }">
              <ul>
                <%
                if(null != ppList){
                    for(pp in ppList){
                %>
                <li class="clearfix" id="post-${pp.pid}" data-pid="${pp.pid}" data-username="${pp.userName}" data-uid="${pp.uid}">
                  <div class="puser">
                    <span class="uname">${pp.userName}</span>
                    ${ (pp.puid != post.uid)?("&nbsp;回复&nbsp;<span class='uname'>"+pp.puserName+"</span>"):""}：
                  </div>
                  <div class="pmessage">${pp.message}</div>
                  <span class="ppost-date">${pp.dateLine}</span>
                  <a class="post-ta icon-ppost ppost-ta" data-pid="${pp.pid}"></a>
                </li>
                <%
                }}
                %>

              </ul>
              <div class="post-editor">
                <div class="post-editor-container"></div>
                <div class="post-editor-bottom clearfix">
                  <div class="left-box"><a href="javascript:void(0);" class="icon-ppost-face"></a></div>
                  <div class="right-box"><a class="btn ppost-btn" href="javascript:void(0);">发表</a></div>
                </div>
              </div>
            </div>

          </li>
          <% }%>
        </ul>

        <div class="reply-box" data-tid="${topic.tid}" id="replyBox">
          <!--style给定宽度可以影响编辑器的最终宽度-->
          <script type="text/plain" id="replyText" style="width:1000px;min-height:120px;" >
              <p>
              <% if(session.user == null){%>
                请登录后再来评论！
              <% }else{ %>
                来了总得说点什么吧？
              <% }%>
              </p>
          </script>

        </div>

        <script type="text/plain" id="postEditor" style="width:100%;min-height:20px;" ></script>

      </div>
    </div>

    <% include("_footer.btl"){} %>
    <% include("_commonjs.btl"){} %>
    <script type="text/javascript" charset="utf-8" src="${ctxPath}/${theme}/js/ue/umeditor.config.js"></script>
    <script type="text/javascript">
      window.UMEDITOR_CONFIG.toolbar = [
        'bold backcolor justifyleft justifycenter justifyright justifyjustify',
        'link unlink emotion image video'
      ]
    </script>
    <script type="text/javascript" charset="utf-8" src="${ctxPath}/${theme}/js/ue/umeditor.js"> </script>
    <script type="text/javascript" src="${ctxPath}/${theme}/js/ue/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript" src="${ctxPath}/${theme}/js/topic.js"></script>

  </body>
</html>
